# Security Advisor Errors

| name                            | title                                                   | level | facing   | categories   | description                                                        | detail                                                                                                                                                                                         | remediation                                                                                              | metadata                                                                         | cache_key                                                                                              |
| ------------------------------- | ------------------------------------------------------- | ----- | -------- | ------------ | ------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------ |
| function_search_path_mutable    | Function Search Path Mutable                            | WARN  | EXTERNAL | ["SECURITY"] | Detects functions where the search_path parameter is not set.      | Function \`public.sync_openrouter_models\` has a role mutable search_path                                                                                                                      | https://supabase.com/docs/guides/database/database-linter?lint=0011_function_search_path_mutable         | {"name":"sync_openrouter_models","type":"function","schema":"public"}            | function_search_path_mutable_public_sync_openrouter_models_7c55c364ec8586f3578397d730d27a42            |
| function_search_path_mutable    | Function Search Path Mutable                            | WARN  | EXTERNAL | ["SECURITY"] | Detects functions where the search_path parameter is not set.      | Function \`public.cleanup_cta_events\` has a role mutable search_path                                                                                                                          | https://supabase.com/docs/guides/database/database-linter?lint=0011_function_search_path_mutable         | {"name":"cleanup_cta_events","type":"function","schema":"public"}                | function_search_path_mutable_public_cleanup_cta_events_0c604c3f14abd93bd4a01f98a9837cf9                |
| function_search_path_mutable    | Function Search Path Mutable                            | WARN  | EXTERNAL | ["SECURITY"] | Detects functions where the search_path parameter is not set.      | Function \`public.get_global_model_costs\` has a role mutable search_path                                                                                                                      | https://supabase.com/docs/guides/database/database-linter?lint=0011_function_search_path_mutable         | {"name":"get_global_model_costs","type":"function","schema":"public"}            | function_search_path_mutable_public_get_global_model_costs_46f095fb482dff0f1c5257083fce763f            |
| function_search_path_mutable    | Function Search Path Mutable                            | WARN  | EXTERNAL | ["SECURITY"] | Detects functions where the search_path parameter is not set.      | Function \`public.ingest_cta_event\` has a role mutable search_path                                                                                                                            | https://supabase.com/docs/guides/database/database-linter?lint=0011_function_search_path_mutable         | {"name":"ingest_cta_event","type":"function","schema":"public"}                  | function_search_path_mutable_public_ingest_cta_event_d8f799df6874cf46436bc7e70f5f9d02                  |
| function_search_path_mutable    | Function Search Path Mutable                            | WARN  | EXTERNAL | ["SECURITY"] | Detects functions where the search_path parameter is not set.      | Function \`public.update_updated_at_column\` has a role mutable search_path                                                                                                                    | https://supabase.com/docs/guides/database/database-linter?lint=0011_function_search_path_mutable         | {"name":"update_updated_at_column","type":"function","schema":"public"}          | function_search_path_mutable_public_update_updated_at_column_8143d02fcae29993883fc31f7aff697c          |
| function_search_path_mutable    | Function Search Path Mutable                            | WARN  | EXTERNAL | ["SECURITY"] | Detects functions where the search_path parameter is not set.      | Function \`public.log_user_activity\` has a role mutable search_path                                                                                                                           | https://supabase.com/docs/guides/database/database-linter?lint=0011_function_search_path_mutable         | {"name":"log_user_activity","type":"function","schema":"public"}                 | function_search_path_mutable_public_log_user_activity_a10f1beac78d3b1517146788ff23d143                 |
| function_search_path_mutable    | Function Search Path Mutable                            | WARN  | EXTERNAL | ["SECURITY"] | Detects functions where the search_path parameter is not set.      | Function \`public.write_admin_audit\` has a role mutable search_path                                                                                                                           | https://supabase.com/docs/guides/database/database-linter?lint=0011_function_search_path_mutable         | {"name":"write_admin_audit","type":"function","schema":"public"}                 | function_search_path_mutable_public_write_admin_audit_f16c96558ef95da2db2b8a658bcaf3d7                 |
| function_search_path_mutable    | Function Search Path Mutable                            | WARN  | EXTERNAL | ["SECURITY"] | Detects functions where the search_path parameter is not set.      | Function \`public.update_session_timestamp\` has a role mutable search_path                                                                                                                    | https://supabase.com/docs/guides/database/database-linter?lint=0011_function_search_path_mutable         | {"name":"update_session_timestamp","type":"function","schema":"public"}          | function_search_path_mutable_public_update_session_timestamp_96409d35b02821c737184cedbad8a565          |
| function_search_path_mutable    | Function Search Path Mutable                            | WARN  | EXTERNAL | ["SECURITY"] | Detects functions where the search_path parameter is not set.      | Function \`public.get_user_allowed_models\` has a role mutable search_path                                                                                                                     | https://supabase.com/docs/guides/database/database-linter?lint=0011_function_search_path_mutable         | {"name":"get_user_allowed_models","type":"function","schema":"public"}           | function_search_path_mutable_public_get_user_allowed_models_0dd2b2f8bb523301a7cf2fd8c512cfb4           |
| function_search_path_mutable    | Function Search Path Mutable                            | WARN  | EXTERNAL | ["SECURITY"] | Detects functions where the search_path parameter is not set.      | Function \`public.can_user_use_model\` has a role mutable search_path                                                                                                                          | https://supabase.com/docs/guides/database/database-linter?lint=0011_function_search_path_mutable         | {"name":"can_user_use_model","type":"function","schema":"public"}                | function_search_path_mutable_public_can_user_use_model_48eb020b5dbb6d6a424a970de0bd4468                |
| function_search_path_mutable    | Function Search Path Mutable                            | WARN  | EXTERNAL | ["SECURITY"] | Detects functions where the search_path parameter is not set.      | Function \`public.update_model_tier_access\` has a role mutable search_path                                                                                                                    | https://supabase.com/docs/guides/database/database-linter?lint=0011_function_search_path_mutable         | {"name":"update_model_tier_access","type":"function","schema":"public"}          | function_search_path_mutable_public_update_model_tier_access_7b38956b07be258187a1b8251da7ea2c          |
| function_search_path_mutable    | Function Search Path Mutable                            | WARN  | EXTERNAL | ["SECURITY"] | Detects functions where the search_path parameter is not set.      | Function \`public.get_user_recent_sessions\` has a role mutable search_path                                                                                                                    | https://supabase.com/docs/guides/database/database-linter?lint=0011_function_search_path_mutable         | {"name":"get_user_recent_sessions","type":"function","schema":"public"}          | function_search_path_mutable_public_get_user_recent_sessions_fe286dce40e067c99d6ae3975f37ce50          |
| function_search_path_mutable    | Function Search Path Mutable                            | WARN  | EXTERNAL | ["SECURITY"] | Detects functions where the search_path parameter is not set.      | Function \`public.update_session_stats\` has a role mutable search_path                                                                                                                        | https://supabase.com/docs/guides/database/database-linter?lint=0011_function_search_path_mutable         | {"name":"update_session_stats","type":"function","schema":"public"}              | function_search_path_mutable_public_update_session_stats_cc6a80041540354e3224af18a383113d              |
| function_search_path_mutable    | Function Search Path Mutable                            | WARN  | EXTERNAL | ["SECURITY"] | Detects functions where the search_path parameter is not set.      | Function \`public.update_user_tier\` has a role mutable search_path                                                                                                                            | https://supabase.com/docs/guides/database/database-linter?lint=0011_function_search_path_mutable         | {"name":"update_user_tier","type":"function","schema":"public"}                  | function_search_path_mutable_public_update_user_tier_b2b171fec596cabc4eb528d41b04a7e9                  |
| function_search_path_mutable    | Function Search Path Mutable                            | WARN  | EXTERNAL | ["SECURITY"] | Detects functions where the search_path parameter is not set.      | Function \`public.\_set_updated_at\` has a role mutable search_path                                                                                                                            | https://supabase.com/docs/guides/database/database-linter?lint=0011_function_search_path_mutable         | {"name":"\_set_updated_at","type":"function","schema":"public"}                  | function_search_path_mutable_public\_\_set_updated_at_38ade2aac04dc896bb02f738edbcf08d                 |
| function_search_path_mutable    | Function Search Path Mutable                            | WARN  | EXTERNAL | ["SECURITY"] | Detects functions where the search_path parameter is not set.      | Function \`public.analyze_database_health\` has a role mutable search_path                                                                                                                     | https://supabase.com/docs/guides/database/database-linter?lint=0011_function_search_path_mutable         | {"name":"analyze_database_health","type":"function","schema":"public"}           | function_search_path_mutable_public_analyze_database_health_66fa26d3725e805017fa9b913da74aeb           |
| function_search_path_mutable    | Function Search Path Mutable                            | WARN  | EXTERNAL | ["SECURITY"] | Detects functions where the search_path parameter is not set.      | Function \`public.sync_openrouter_models\` has a role mutable search_path                                                                                                                      | https://supabase.com/docs/guides/database/database-linter?lint=0011_function_search_path_mutable         | {"name":"sync_openrouter_models","type":"function","schema":"public"}            | function_search_path_mutable_public_sync_openrouter_models_b90eaa28d7a76effbfa856f05515dc18            |
| function_search_path_mutable    | Function Search Path Mutable                            | WARN  | EXTERNAL | ["SECURITY"] | Detects functions where the search_path parameter is not set.      | Function \`public.cleanup_old_data\` has a role mutable search_path                                                                                                                            | https://supabase.com/docs/guides/database/database-linter?lint=0011_function_search_path_mutable         | {"name":"cleanup_old_data","type":"function","schema":"public"}                  | function_search_path_mutable_public_cleanup_old_data_3a1f3ea0d123da49a0a77046e64332e8                  |
| function_search_path_mutable    | Function Search Path Mutable                            | WARN  | EXTERNAL | ["SECURITY"] | Detects functions where the search_path parameter is not set.      | Function \`public.calculate_and_record_message_cost\` has a role mutable search_path                                                                                                           | https://supabase.com/docs/guides/database/database-linter?lint=0011_function_search_path_mutable         | {"name":"calculate_and_record_message_cost","type":"function","schema":"public"} | function_search_path_mutable_public_calculate_and_record_message_cost_bec102fba79b8213d04a2fa2a35fb136 |
| function_search_path_mutable    | Function Search Path Mutable                            | WARN  | EXTERNAL | ["SECURITY"] | Detects functions where the search_path parameter is not set.      | Function \`public.track_user_usage\` has a role mutable search_path                                                                                                                            | https://supabase.com/docs/guides/database/database-linter?lint=0011_function_search_path_mutable         | {"name":"track_user_usage","type":"function","schema":"public"}                  | function_search_path_mutable_public_track_user_usage_55fe579ad167dabcd6bf70506c322e55                  |
| function_search_path_mutable    | Function Search Path Mutable                            | WARN  | EXTERNAL | ["SECURITY"] | Detects functions where the search_path parameter is not set.      | Function \`public.track_session_creation\` has a role mutable search_path                                                                                                                      | https://supabase.com/docs/guides/database/database-linter?lint=0011_function_search_path_mutable         | {"name":"track_session_creation","type":"function","schema":"public"}            | function_search_path_mutable_public_track_session_creation_ccdd97db93ee3c06d1fa528a6cc8022d            |
| function_search_path_mutable    | Function Search Path Mutable                            | WARN  | EXTERNAL | ["SECURITY"] | Detects functions where the search_path parameter is not set.      | Function \`public.get_user_complete_profile\` has a role mutable search_path                                                                                                                   | https://supabase.com/docs/guides/database/database-linter?lint=0011_function_search_path_mutable         | {"name":"get_user_complete_profile","type":"function","schema":"public"}         | function_search_path_mutable_public_get_user_complete_profile_b92a58c998562d492c9d3f3ef5d2a825         |
| function_search_path_mutable    | Function Search Path Mutable                            | WARN  | EXTERNAL | ["SECURITY"] | Detects functions where the search_path parameter is not set.      | Function \`public.handle_user_profile_sync\` has a role mutable search_path                                                                                                                    | https://supabase.com/docs/guides/database/database-linter?lint=0011_function_search_path_mutable         | {"name":"handle_user_profile_sync","type":"function","schema":"public"}          | function_search_path_mutable_public_handle_user_profile_sync_cd123fbeb8a100dc8b1c3ffe1122442e          |
| auth_leaked_password_protection | Leaked Password Protection Disabled                     | WARN  | EXTERNAL | ["SECURITY"] | Leaked password protection is currently disabled.                  | Supabase Auth prevents the use of compromised passwords by checking against HaveIBeenPwned.org. Enable this feature to enhance security.                                                       | https://supabase.com/docs/guides/auth/password-security#password-strength-and-leaked-password-protection | {"type":"auth","entity":"Auth"}                                                  | auth_leaked_password_protection                                                                        |
| vulnerable_postgres_version     | Current Postgres version has security patches available | WARN  | EXTERNAL | ["SECURITY"] | Upgrade your postgres database to apply important security patches | We have detected that the current version of postgres, supabase-postgres-17.4.1.054, has outstanding security patches available. Upgrade your database to receive the latest security patches. | https://supabase.com/docs/guides/platform/upgrading                                                      | {"type":"compliance","entity":"Config"}                                          | vulnerable_postgres_version                                                                            |

## Analysis and implementation plan

Decision summary

- function_search_path_mutable → Fix. Pin each function’s search_path and prefer schema-qualified references. No app code changes expected when signatures stay the same.
- auth_leaked_password_protection → Ignore. App uses Google OAuth only; disable email/password provider; feature is Pro-only.
- vulnerable_postgres_version → Fix. Schedule managed upgrade to apply security patches.

Why function_search_path_mutable matters

- Unpinned search_path allows name shadowing/hijacking if a caller’s path includes writable schemas. Functions may resolve unqualified names to the wrong object.
- Pinning search_path to a minimal trusted set (pg_catalog, public) makes name resolution deterministic and safer, especially for SECURITY DEFINER functions.

Scope (functions to harden)

- public.sync_openrouter_models
- public.cleanup_cta_events
- public.get_global_model_costs
- public.ingest_cta_event
- public.update_updated_at_column
- public.log_user_activity
- public.write_admin_audit
- public.update_session_timestamp
- public.get_user_allowed_models
- public.can_user_use_model
- public.update_model_tier_access
- public.get_user_recent_sessions
- public.update_session_stats
- public.update_user_tier
- public.\_set_updated_at
- public.analyze_database_health
- public.cleanup_old_data
- public.calculate_and_record_message_cost
- public.track_user_usage
- public.track_session_creation
- public.get_user_complete_profile
- public.handle_user_profile_sync

Implementation plan (low-risk)

1. Add a single idempotent patch that alters each function to pin search_path using: ALTER FUNCTION ... SET search_path = 'pg_catalog, public'. This avoids redefining bodies and works for all overloads via catalog-driven iteration.
2. Prefer schema-qualifying built-ins and objects in future edits (e.g., pg_catalog.now(), public.table_name), but this patch focuses on pinning search_path only.
3. Wrap in one transaction (DO block) and emit NOTICEs per function for auditability.

Operational impact

- No application code changes. Function signatures remain the same; triggers and RPC references continue to work.
- Order generally does not matter; for neatness, the patch updates all matching overloads automatically.

Verification steps

- Re-run the Supabase database linter; warning 0011 should clear for the listed functions.
- Smoke-test common DB paths (insert/update rows that trigger update_updated_at_column; call a couple of RPCs).

Rollback plan

- Run a companion DO block to ALTER FUNCTION ... RESET search_path for the same set if needed.
